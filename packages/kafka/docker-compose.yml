version: '3.8'
services:
  redpanda-1:
    image: docker.redpanda.com/redpandadata/redpanda:v23.3.13
    container_name: redpanda-1
    command:
      - redpanda
      - start
      - --smp 1
      - --memory 1G
      - --overprovisioned
      - --node-id 0
      - --kafka-addr PLAINTEXT://0.0.0.0:29092,OUTSIDE://0.0.0.0:9094
      - --advertise-kafka-addr PLAINTEXT://redpanda-1:29092,OUTSIDE://localhost:9094
      - --rpc-addr redpanda-1:33145
      - --advertise-rpc-addr redpanda-1:33145
      - --seeds redpanda-1:33145,redpanda-2:33145,redpanda-3:33145
    ports:
      - "9094:9094"
    networks:
      - kafka-network

  redpanda-2:
    image: docker.redpanda.com/redpandadata/redpanda:v23.3.13
    container_name: redpanda-2
    command:
      - redpanda
      - start
      - --smp 1
      - --memory 1G
      - --overprovisioned
      - --node-id 1
      - --kafka-addr PLAINTEXT://0.0.0.0:29092,OUTSIDE://0.0.0.0:9095
      - --advertise-kafka-addr PLAINTEXT://redpanda-2:29092,OUTSIDE://localhost:9095
      - --rpc-addr redpanda-2:33145
      - --advertise-rpc-addr redpanda-2:33145
      - --seeds redpanda-1:33145,redpanda-2:33145,redpanda-3:33145
    ports:
      - "9095:9095"
    networks:
      - kafka-network

  redpanda-3:
    image: docker.redpanda.com/redpandadata/redpanda:v23.3.13
    container_name: redpanda-3
    command:
      - redpanda
      - start
      - --smp 1
      - --memory 1G
      - --overprovisioned
      - --node-id 2
      - --kafka-addr PLAINTEXT://0.0.0.0:29092,OUTSIDE://0.0.0.0:9096
      - --advertise-kafka-addr PLAINTEXT://redpanda-3:29092,OUTSIDE://localhost:9096
      - --rpc-addr redpanda-3:33145
      - --advertise-rpc-addr redpanda-3:33145
      - --seeds redpanda-1:33145,redpanda-2:33145,redpanda-3:33145
    ports:
      - "9096:9096"
    networks:
      - kafka-network

  kafka-ui:
    image: provectuslabs/kafka-ui:latest
    container_name: kafka-ui
    environment:
      KAFKA_CLUSTERS_0_NAME: "local-cluster"
      # Usar los puertos internos (29092) para comunicaci√≥n entre contenedores
      KAFKA_CLUSTERS_0_BOOTSTRAPSERVERS: "redpanda-1:29092,redpanda-2:29092,redpanda-3:29092"
      KAFKA_CLUSTERS_0_READONLY: "false"
      KAFKA_CLUSTERS_0_TOPIC_AUTO_CREATE: "true"
      KAFKA_CLUSTERS_0_KRAFTMODE: "true"
    ports:
      - "8080:8080"
    depends_on:
      - redpanda-1
      - redpanda-2
      - redpanda-3
    networks:
      - kafka-network

networks:
  kafka-network:
    driver: bridge